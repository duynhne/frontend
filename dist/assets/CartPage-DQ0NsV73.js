import{c as S,e as k,r,j as s,L as N,g as L,h as T,i as w}from"./index-B_7VeGgU.js";function I(){var g,y,f;const j=S(),{notify:n}=k(),[t,b]=r.useState(null),[i,d]=r.useState(!0),[c,p]=r.useState(null),[o,l]=r.useState(null),h=!!localStorage.getItem("authToken"),u=async()=>{d(!0),p(null);try{const e=await L();b(e)}catch(e){p(e.message)}finally{d(!1)}};r.useEffect(()=>{if(!h){d(!1);return}u()},[h]);const m=async(e,a)=>{if(!(a<1)){l(e);try{const v=await T(e,a);n("success","Updated!"),u()}catch(v){n("error",v.message)}finally{l(null)}}},C=async e=>{l(e);try{const a=await w(e);n("success","Removed!"),u()}catch(a){n("error",a.message)}finally{l(null)}},x=(t==null?void 0:t.items)||[];return h?s.jsxs("div",{className:"page container",children:[s.jsx("h2",{children:"Shopping Cart"}),s.jsx("p",{className:"api-label",children:"API: GET /api/v1/cart"}),i&&s.jsx("div",{className:"loading",children:"Loading cart..."}),!i&&c&&s.jsxs("div",{className:"error",children:["Error: ",c]}),!i&&!c&&x.length===0&&s.jsxs("div",{className:"empty",children:[s.jsx("p",{children:"Your cart is empty"}),s.jsx(N,{to:"/",children:"Browse Products"})]}),!i&&!c&&x.length>0&&s.jsxs("div",{className:"two-col",children:[s.jsxs("div",{className:"card",children:[s.jsxs("h3",{children:["Items (",t.item_count,")"]}),x.map(e=>{var a;return s.jsxs("div",{className:"cart-item",children:[s.jsxs("div",{children:[s.jsx("strong",{children:e.product_name}),s.jsxs("p",{className:"text-muted",children:["$",e.product_price," each"]})]}),s.jsxs("div",{className:"cart-item-actions",children:[s.jsx("button",{onClick:()=>m(e.id,e.quantity-1),disabled:o===e.id||e.quantity<=1,children:"âˆ’"}),s.jsx("span",{children:e.quantity}),s.jsx("button",{onClick:()=>m(e.id,e.quantity+1),disabled:o===e.id,children:"+"}),s.jsxs("span",{className:"cart-item-subtotal",children:["$",(a=e.subtotal)==null?void 0:a.toFixed(2)]}),s.jsx("button",{className:"danger",onClick:()=>C(e.id),disabled:o===e.id,children:"Remove"})]})]},e.id)})]}),s.jsxs("div",{className:"card",children:[s.jsx("h3",{children:"Order Summary"}),s.jsx("table",{children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("th",{children:"Subtotal"}),s.jsxs("td",{children:["$",(g=t.subtotal)==null?void 0:g.toFixed(2)]})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"Shipping"}),s.jsxs("td",{children:["$",(y=t.shipping)==null?void 0:y.toFixed(2)]})]}),s.jsxs("tr",{children:[s.jsx("th",{children:s.jsx("strong",{children:"Total"})}),s.jsx("td",{children:s.jsxs("strong",{children:["$",(f=t.total)==null?void 0:f.toFixed(2)]})})]})]})}),s.jsx(N,{to:"/checkout",children:s.jsx("button",{className:"primary",style:{width:"100%",marginTop:"0.75rem"},children:"Proceed to Checkout"})})]})]}),s.jsxs("details",{className:"api-debug",children:[s.jsx("summary",{children:"API Response"}),s.jsx("pre",{children:JSON.stringify(t,null,2)})]})]}):s.jsxs("div",{className:"page container",children:[s.jsx("h2",{children:"Shopping Cart"}),s.jsxs("div",{className:"empty",style:{marginTop:"1rem"},children:[s.jsx("p",{children:"You need to log in to view your cart."}),s.jsxs("div",{style:{marginTop:"1rem",display:"flex",gap:"0.5rem",justifyContent:"center"},children:[s.jsx("button",{className:"primary",onClick:()=>j("/login"),children:"Login"}),s.jsx("button",{onClick:()=>j("/"),children:"Continue Shopping"})]})]})]})}export{I as default};
