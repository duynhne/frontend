import{a as k,c as M,r as n,j as e}from"./index-y3nl-1dH.js";import{u as b,a as E,P as N,L,A as _}from"./ApiDebug-YCnoPG3x.js";import{u as R}from"./useApiMutation-DEFwsEDw.js";import{A as w}from"./ApiError-Bd4zEiP4.js";import{E as v}from"./EmptyState-E_34ce5k.js";import"./errorMessages-JRjuVPVt.js";async function P(){return(await k.get("/notifications")).data}async function T(t){return(await k.patch(`/notifications/${t}`)).data}function I(){const t=M(),{isAuthenticated:o,requireAuth:h}=b();n.useEffect(()=>{h(t,"/notifications")},[h,t]);const{data:i,loading:r,error:c,mutate:d}=E(o?"notifications":null,P),{mutate:A,loading:u}=R(T,{successMessage:"Marked as read",errorMessage:"Failed to mark as read"}),y=async s=>{d(i==null?void 0:i.map(m=>m.id===s?{...m,read:!0}:m),!1);const j=await A(s);d()},a=n.useMemo(()=>i||[],[i]),l=n.useMemo(()=>a.filter(s=>!s.read).length,[a]),p=n.useMemo(()=>a.filter(s=>!s.read),[a]),g=n.useMemo(()=>a.filter(s=>s.read),[a]),x=s=>({order_shipped:"üì¶",order_completed:"‚úÖ",order_placed:"üõí",order_processing:"‚öôÔ∏è",review_reminder:"‚≠ê",promotion:"üéâ",cart_reminder:"üõçÔ∏è",email:"üìß",sms:"üì±"})[s]||"üîî",f=s=>{if(!s)return"";try{return new Date(s).toLocaleString()}catch{return""}};return o?e.jsxs("div",{className:"page container",children:[e.jsx(N,{title:"Notifications",backLink:"/",backText:"‚Üê Back to Home",apiLabel:`API: GET /api/v1/notifications ‚Ä¢ ${a.length} items`}),r&&e.jsx(L,{message:"Loading notifications...",variant:"list",count:3}),!r&&c&&e.jsx(w,{error:c,endpoint:"GET /api/v1/notifications"}),!r&&!c&&a.length===0&&e.jsx(v,{message:"No notifications",icon:"üîî"}),!r&&!c&&a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notification-summary",children:e.jsx("p",{children:l>0?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:l})," unread notification",l!==1?"s":""]}):"All caught up! üéâ"})}),p.length>0&&e.jsxs("div",{className:"notification-section unread",children:[e.jsx("h3",{children:"Unread"}),p.map(s=>e.jsx("div",{className:"notification-item unread",children:e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-body",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("span",{className:"notification-icon",children:x(s.type)}),e.jsx("h4",{className:"notification-title",children:s.title||s.message})]}),s.title&&s.message!==s.title&&e.jsx("p",{className:"notification-message",children:s.message}),e.jsx("p",{className:"notification-time",children:f(s.created_at)})]}),e.jsx("div",{className:"notification-actions",children:e.jsx("button",{className:"primary",onClick:()=>y(s.id),disabled:u,children:u?"Marking...":"Mark as Read"})})]})},s.id))]}),g.length>0&&e.jsxs("div",{className:"notification-section read",children:[e.jsx("h3",{children:"Read"}),g.map(s=>e.jsx("div",{className:"notification-item read",children:e.jsxs("div",{className:"notification-body",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("span",{className:"notification-icon",children:x(s.type)}),e.jsx("h4",{className:"notification-title",children:s.title||s.message})]}),s.title&&s.message!==s.title&&e.jsx("p",{className:"notification-message",children:s.message}),e.jsx("p",{className:"notification-time",children:f(s.created_at)})]})},s.id))]})]}),e.jsx(_,{data:i})]}):e.jsxs("div",{className:"page container",children:[e.jsx(N,{title:"Notifications",backLink:"/",backText:"‚Üê Back to Home"}),e.jsx(v,{message:"Please log in to view notifications",icon:"üîí"})]})}export{I as default};
