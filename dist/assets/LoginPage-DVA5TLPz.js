import{a as f,c as w,o as y,e as N,r as o,j as e,L as b}from"./index-B_7VeGgU.js";async function k(n,i){return(await f.post("/auth/login",{username:n,password:i})).data}async function S(n,i,l){return(await f.post("/auth/register",{username:n,email:i,password:l})).data}function E(){const n=w(),[i]=y(),{notify:l}=N(),g=i.get("returnTo")||"/",c=i.get("mode")||"login",[r,u]=o.useState(c),[m,h]=o.useState(!1),[x,p]=o.useState(!1),[s,d]=o.useState({username:"alice",email:"alice@example.com",password:"password123"});o.useEffect(()=>{const a=localStorage.getItem("authToken");p(!!a)},[]),o.useEffect(()=>{(c==="login"||c==="register")&&u(c)},[c]);const j=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),p(!1),window.dispatchEvent(new Event("storage"))},v=async a=>{a.preventDefault(),h(!0);try{let t;r==="login"?t=await k(s.username,s.password):t=await S(s.username,s.email,s.password),t.token&&(localStorage.setItem("authToken",t.token),window.dispatchEvent(new Event("storage"))),t.user&&localStorage.setItem("authUser",JSON.stringify(t.user)),l("success",`${r==="login"?"Login":"Registration"} successful!`),setTimeout(()=>n(g),800)}catch(t){l("error",t.message||"Authentication failed")}finally{h(!1)}};return x?e.jsx("div",{className:"auth-page",children:e.jsxs("div",{className:"auth-form",children:[e.jsx("h2",{children:"Already Logged In"}),e.jsx("div",{className:"success",style:{marginBottom:"1rem"},children:"You are already logged in."}),e.jsx("button",{className:"primary",style:{width:"100%",marginBottom:"0.5rem"},onClick:()=>n("/"),children:"Go to Products"}),e.jsx("button",{style:{width:"100%"},onClick:j,children:"Logout"})]})}):e.jsx("div",{className:"auth-page",children:e.jsxs("div",{className:"auth-form",children:[e.jsx(b,{to:"/",className:"back-link",children:"â† Back"}),e.jsx("h2",{children:r==="login"?"Login":"Register"}),e.jsxs("p",{className:"api-label",children:["API: POST /api/v1/auth/",r==="login"?"login":"register"]}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Username"}),e.jsx("input",{type:"text",placeholder:"alice",value:s.username,onChange:a=>d({...s,username:a.target.value}),required:!0})]}),r==="register"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",placeholder:"user@example.com",value:s.email,onChange:a=>d({...s,email:a.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password"}),e.jsx("input",{type:"password",value:s.password,onChange:a=>d({...s,password:a.target.value}),required:!0})]}),e.jsx("button",{type:"submit",className:"primary",style:{width:"100%"},disabled:m,children:m?"Please wait...":r==="login"?"Login":"Register"})]}),e.jsx("div",{className:"auth-toggle",children:r==="login"?e.jsxs("p",{children:["No account?"," ",e.jsx("button",{onClick:()=>u("register"),children:"Register"})]}):e.jsxs("p",{children:["Have account?"," ",e.jsx("button",{onClick:()=>u("login"),children:"Login"})]})})]})})}export{E as default};
